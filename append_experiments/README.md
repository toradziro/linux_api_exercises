Это упражнение демонстрирует необходимость атомарности, гарантированной при открытии файла с флагом O_APPEND. Напишите программу, получающую до трех аргументов командной строки:
> $ atomic_append filename num-bytes [x]
Эта программа должна открыть файл с именем, указанным в аргументе filename (создав его при необходимости), и дополнить его количеством байтов, заданным в аргументе num-bytes, используя вызов write() для побайтовой записи. По умолчанию программа должна открыть файл с флагом O_APPEND, но, если есть третий аргумент командной строки (x), флаг O_APPEND должен быть опущен. При этом, вместо того чтобы добавлять байты, программа должна выполнять перед каждым вызовом write() вызов lseek(fd, 0, SEEK_END). Запустите одновременно два экземпляра этой программы без аргумента x для записи одного миллиона байтов в один и тот же файл:
> $ atomic_append f1 1000000 & atomic_append f1 1000000
Повторите те же действия, ведя запись в другой файл, но на этот раз с указанием аргумента x:
> $ atomic_append f2 1000000 x & atomic_append f2 1000000 x
Выведите на экран размеры файлов f1 и f2, воспользовавшись командой ls –l, и объясните разницу между ними.